<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAI æç¤ºè¯å·¥ä½œå° - æ•°æ®è¿ç§»ç‰ˆ</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#73daca">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        :root {
            --bg-color: #0d0f14;
            --card-bg: #161922;
            --accent: #73daca;
            --delete: #f7768e;
            --text: #a9b1d6;
            --input-bg: #1a1b26;
        }

        body { font-family: 'PingFang SC', sans-serif; background: var(--bg-color); color: var(--text); padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* å›ºå®šè¾“å‡ºåŒº */
        .sticky-header { position: sticky; top: 0; background: var(--bg-color); padding: 15px 0; z-index: 1000; border-bottom: 2px solid var(--card-bg); }
        #display-area { 
            width: 100%; height: 100px; background: var(--input-bg); color: #e0af68; 
            border: 1px solid #333; border-radius: 10px; padding: 12px; 
            font-family: monospace; font-size: 14px; margin-bottom: 12px; box-sizing: border-box;
        }

        .action-bar { display: flex; gap: 10px; margin-bottom: 10px; }
        .search-bar { flex: 1; padding: 10px; border-radius: 6px; border: 1px solid #333; background: var(--input-bg); color: white; }

        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; }
        .btn-copy { background: var(--accent); color: #000; }
        .btn-clear { background: #3b4261; color: white; }
        .btn-add { background: #bb9af7; color: #000; }
        .btn-data { background: #444b6a; color: #fff; }

        /* ç®¡ç†é¢æ¿ */
        .admin-panel { 
            background: var(--card-bg); padding: 15px; border-radius: 10px; 
            margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; border: 1px dashed #444;
        }
        .admin-panel input, .admin-panel select { background: var(--input-bg); border: 1px solid #444; color: white; padding: 8px; border-radius: 4px; }

        /* æ•°æ®è¿ç§»åŒº */
        #data-zone { display: none; background: #1a1b26; padding: 15px; border-radius: 10px; margin-top: 10px; border: 1px solid var(--accent); }
        #data-io { width: 100%; height: 80px; background: #000; color: #7aa2f7; font-family: monospace; margin-bottom: 10px; padding: 10px; box-sizing: border-box; }

        /* è¯åº“ */
        .category-group { margin-bottom: 30px; }
        .category-hd { font-size: 18px; color: var(--accent); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .category-hd::after { content: ""; flex: 1; height: 1px; background: #333; }
        
        .tags-flex { display: flex; flex-wrap: wrap; gap: 12px; }
        .tag-item { 
            position: relative; background: #24283b; padding: 8px 15px; border-radius: 6px; 
            cursor: pointer; border: 1px solid #2f334d; user-select: none; transition: 0.2s;
        }
        .tag-item:hover { background: #2f334d; border-color: var(--accent); transform: translateY(-2px); }
        .tag-item .zh { font-size: 11px; display: block; opacity: 0.5; margin-top: 2px; }
        
        .tag-del { 
            position: absolute; top: -8px; right: -8px; background: var(--delete); 
            width: 18px; height: 18px; border-radius: 50%; display: none; 
            justify-content: center; align-items: center; font-size: 10px; color: white; 
        }
        .tag-item:hover .tag-del { display: flex; }
    </style>
</head>
<body>

<div class="container">
    <div class="sticky-header">
        <textarea id="display-area" placeholder="ç‚¹å‡»æ ‡ç­¾ç”Ÿæˆ Prompt..."></textarea>
        <div class="action-bar">
            <input type="text" class="search-bar" id="search-input" placeholder="ğŸ” æœç´¢ (ä¸­è‹±æ–‡)..." oninput="render()">
            <button class="btn btn-copy" onclick="copyResult()">ä¸€é”®å¤åˆ¶</button>
            <button class="btn btn-clear" onclick="clearResult()">æ¸…ç©ºç”»å¸ƒ</button>
            <button class="btn btn-data" onclick="toggleDataZone()">æ•°æ®å¤‡ä»½/æ¢å¤</button>
        </div>

        <div id="data-zone">
            <p style="margin-top:0; font-size: 12px; color: #9ece6a;">å°†å¯¼å‡ºçš„ä»£ç å¤åˆ¶ä¿å­˜ï¼Œä¸‹æ¬¡ç²˜è´´åˆ°æ­¤å¤„ç‚¹å‡»â€œå¯¼å…¥æ•°æ®â€å³å¯æ¢å¤ã€‚</p>
            <textarea id="data-io" placeholder="åœ¨æ­¤ç²˜è´´å¯¼å‡ºçš„ JSON æ•°æ®..."></textarea>
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:#7aa2f7; color:#000;" onclick="importData()">ç¡®è®¤å¯¼å…¥</button>
                <button class="btn" style="background:#e0af68; color:#000;" onclick="exportData()">å¯¼å‡ºå½“å‰è¯åº“</button>
            </div>
        </div>
    </div>

    <div class="admin-panel">
        <strong>å¿«é€Ÿæ·»åŠ ï¼š</strong>
        <select id="reg-cat">
            <option value="ç”»é£">ğŸ¨ ç”»é£</option>
            <option value="äººç‰©">ğŸ‘¤ äººç‰©</option>
            <option value="åŠ¨ä½œ">ğŸƒ åŠ¨ä½œ</option>
            <option value="æœè£…">ğŸ‘— æœè£…</option>
            <option value="ç¯å¢ƒ">ğŸŒ† ç¯å¢ƒ</option>
            <option value="é“å…·">ğŸ’ é“å…·</option>
        </select>
        <input type="text" id="reg-en" placeholder="è‹±æ–‡">
        <input type="text" id="reg-zh" placeholder="ä¸­æ–‡">
        <button class="btn btn-add" onclick="addEntry()">æ·»åŠ è¯æ±‡</button>
    </div>

    <div id="lib-content"></div>
</div>

<script>
    // --- PWA Service Worker æ³¨å†Œä»£ç å¼€å§‹ ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('PWA æ³¨å†ŒæˆåŠŸ, ä½œç”¨åŸŸä¸º: ', reg.scope))
                .catch(err => console.log('PWA æ³¨å†Œå¤±è´¥: ', err));
        });
    }
    // --- PWA Service Worker æ³¨å†Œä»£ç ç»“æŸ ---

    const STORAGE_KEY = 'nai_v4_db';
    
    // åˆå§‹åŒ–æ•°æ®
    let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
        "ç”»é£": [{en: "masterpiece", zh: "æ°ä½œ"}],
        "äººç‰©": [{en: "1girl", zh: "å¥³å­©"}],
        "åŠ¨ä½œ": [{en: "standing", zh: "ç«™ç«‹"}],
        "æœè£…": [{en: "dress", zh: "è¿è¡£è£™"}],
        "ç¯å¢ƒ": [{en: "forest", zh: "æ£®æ—"}],
        "é“å…·": [{en: "sword", zh: "å‰‘"}]
    };

    let resultList = [];

    function render() {
        const container = document.getElementById('lib-content');
        const search = document.getElementById('search-input').value.toLowerCase();
        container.innerHTML = '';

        for (let cat in db) {
            const filtered = db[cat].filter(i => i.en.toLowerCase().includes(search) || i.zh.includes(search));
            if (filtered.length === 0 && search !== "") continue;

            const group = document.createElement('div');
            group.className = 'category-group';
            group.innerHTML = `<div class="category-hd">${cat}</div>`;
            
            const flex = document.createElement('div');
            flex.className = 'tags-flex';

            filtered.forEach(item => {
                const tag = document.createElement('div');
                tag.className = 'tag-item';
                tag.innerHTML = `<strong>${item.en}</strong><span class="zh">${item.zh}</span>
                                 <div class="tag-del" onclick="deleteEntry(event, '${cat}', '${item.en}')">âœ•</div>`;
                tag.onclick = () => { resultList.push(item.en); updateTextarea(); };
                flex.appendChild(tag);
            });

            group.appendChild(flex);
            container.appendChild(group);
        }
    }

    function updateTextarea() { document.getElementById('display-area').value = resultList.join(', '); }
    function clearResult() { resultList = []; updateTextarea(); }
    function copyResult() {
        document.getElementById('display-area').select();
        document.execCommand('copy');
        alert('å¤åˆ¶æˆåŠŸï¼');
    }

    function addEntry() {
        const cat = document.getElementById('reg-cat').value;
        const en = document.getElementById('reg-en').value.trim();
        const zh = document.getElementById('reg-zh').value.trim();
        if (en && zh) {
            db[cat].push({en, zh});
            saveDB();
            render();
            document.getElementById('reg-en').value = '';
            document.getElementById('reg-zh').value = '';
        }
    }

    function deleteEntry(e, cat, en) {
        e.stopPropagation();
        if (confirm(`åˆ é™¤ "${en}"ï¼Ÿ`)) {
            db[cat] = db[cat].filter(i => i.en !== en);
            saveDB();
            render();
        }
    }

    function saveDB() { localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }

    // --- æ•°æ®å¯¼å…¥å¯¼å‡ºé€»è¾‘ ---
    function toggleDataZone() {
        const zone = document.getElementById('data-zone');
        zone.style.display = (zone.style.display === 'block') ? 'none' : 'block';
    }

    function exportData() {
        const dataStr = JSON.stringify(db, null, 2);
        document.getElementById('data-io').value = dataStr;
        document.getElementById('data-io').select();
        alert('è¯åº“æ•°æ®å·²ç”Ÿæˆåœ¨ä¸‹æ–¹æ–‡æœ¬æ¡†ä¸­ï¼Œè¯·å¤åˆ¶å¹¶ä¿å­˜åˆ°è®°äº‹æœ¬ã€‚');
    }

    function importData() {
        const input = document.getElementById('data-io').value;
        try {
            const parsed = JSON.parse(input);
            if (confirm("å¯¼å…¥æ–°æ•°æ®å°†è¦†ç›–å½“å‰è¯åº“ï¼Œç¡®å®šå—ï¼Ÿ")) {
                db = parsed;
                saveDB();
                render();
                alert("å¯¼å…¥æˆåŠŸï¼");
                toggleDataZone();
            }
        } catch (e) {
            alert("å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ç¡®ä¿ç²˜è´´çš„æ˜¯å®Œæ•´çš„ JSON ä»£ç ã€‚");
        }
    }

    render();
</script>

</body>
</html>
